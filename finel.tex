\documentclass[twoside,a4paper,12pt]{article}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{booktabs}

% fancy notations https://en.wikibooks.org/wiki/LaTeX/Mathematics
\usepackage{mathrsfs}
\usepackage{amssymb}            % for mathfrak -- canonical font

\usepackage[left=3cm,right=3cm,top=2cm,bottom=2cm,asymmetric]{geometry}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% hyperlinks in the document
\usepackage{hyperref}
% https://tex.stackexchange.com/questions/823/remove-ugly-borders-around-clickable-cross-references-and-hyperlinks
\hypersetup{
    colorlinks,
    linkcolor={red!80!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% https://tex.stackexchange.com/questions/135649/make-citemy-reference-show-name-and-year
\usepackage{natbib}             % citations including name and year
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% code listings
\usepackage{listings}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.3,0.3,0.3}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.8,0.8,0.8}
\definecolor{BLUE}{rgb}{1.,1.,0.}
 
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{black!10},   
    % commentstyle=\color{black!80},
    commentstyle=\color{codegreen},
    keywordstyle={\bf\ttfamily\color{black}},
    stringstyle={\it\ttfamily\color{black!70}},
    numberstyle=\scriptsize\color{black!70},
    % basicstyle=\footnotesize,
    % breakatwhitespace=false,         
    % breaklines=true,                 
    captionpos=t,                    
    basicstyle=\scriptsize\ttfamily\color{black!90},
    % keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,   
    stepnumber=5,
    firstnumber=1,
    numberfirstline=false,
    belowcaptionskip=-1em,
    % showspaces=false,                
    % showstringspaces=false,
    % showtabs=false,                  
    % tabsize=2
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% escape underscore environment
% https://tex.stackexchange.com/questions/20890/define-an-escape-underscore-environment
\usepackage{url}
\DeclareUrlCommand\code{\urlstyle{tt}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% strike out 
% https://tex.stackexchange.com/questions/23711/strikethrough-text
\usepackage{soul}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\figref}[1]{Figure~\ref{#1}}
\newcommand{\tabref}[1]{Table~\ref{#1}}

\newcommand{\prog}[1]{\textsf{#1}}

\newcommand{\python}{\prog{Python}}
\newcommand{\numpy}{\prog{NumPy}}
\newcommand{\lapack}{\prog{LAPACK}}

\newcommand{\ie}{{\it i.e.\ }}

\newcommand{\note}[1]{{\color{red}(#1)}}
\newcommand{\X}[1]{{\color{brown}\st#1} } % removed text
\newcommand{\A}[1]{{\color{purple}#1}} % added text
\newcommand{\QM}{{\color{red}(?)}}

\input{nots.tex}

\begin{document}

\section{Statement of the system}

This program aims to use finite elements methods to solve the boundary
value problem
%
\begin{align}
  \young(x) \area(x) u_{,xx} + f(x) = 0, \label{eq:bvp}
  &&u(L) = \bcg, u_{,x}(0) = -\bch,
\end{align}
where $L$ is the length, $\young(x)$ is Young's modulus and $\area$ is
the cross section area, $u(x)$ is a deformation of the of the object
in consideration, and shorthand notation for a derivative is written
after a coma in a subscript, e.g. $u_{,x} = \partial u /\partial x$.  The
function $f(x)$ represents the body forces. The $\bcg$ and $\bch$ are
essential and natural boundary conditions respectively.

Let $u(x)$ be a solution of system \eqref{eq:bvp} then we may write
%
\begin{align}
  0 = \int_0^L (\young(x) \area(x) u_{,xx} + f(x)) w(x) \dd x 
\end{align}
and $w(x)$ is a chosen \emph{weighting (test) function} that satisfies a
criteria $w(L)=0$.
%
Using integration by parts we get
%
\begin{align}
  \int_0^L \young(x) \area(x) u_{,xx} w(x) \dd x 
  -\int_0^L f(x) w(x) \dd x  =
   \int_0^L u_{,x} (\young(x) \area(x) w(x))_{,x} \dd x -\nonumber \\ -
  (u_{,x} (\young(x) \area(x)  w(x))\big|_0^L -
  \int_0^L f(x) w(x) \dd x =  
  %
  \int_0^L u_{,x} (\young(x) \area(x) w(x))_{,x} \dd x -\nonumber \\ -
  (u_{,x}(L) (\young(L) \area(L)  w(L) -
  u_{,x}(0) \young(0) \area(0)  w(0)) 
  -\int_0^L f(x) w(x) \dd x = 0
\end{align}
%
and using the boundary values and the property of the weighting
function, the previous simplifies as
%
\begin{align}
  \int_0^L u_{,x} (\young(x) \area(x) w(x))_{,x} \dd x =  
  \int_0^L f(x) w(x) \dd x + \bch \young(0) \area(0)  w(0)
  \label{eq:weak-exact}
\end{align}
%
this method is called a \emph{weak (variational)}.

The solution of this system can be found by strong (classical) method
or weak (variational) method. The equivalence with the \emph{strong
  (classical)} method goes under a name \emph{fundamental lemma} which we will not show in here.

To solve the system numerically we will use Galerkin approximation
method. This method uses \eqref{eq:weak-exact} and provides an
approximation of the boundary value problem \eqref{eq:bvp} as
%
\begin{align}
a(\young\area\wwh,\uuh) = (\wwh,f) + \bch \young(0)\area(0)\wwh(0) \label{eq:weak-approx}
\end{align}
%
where we define the operators $a(y,z) = \int_0^L y_{,x} z_{,x} \dd x$
and $(y,z) = \int_0^L y z \dd x$ for arbitrary functions $y = y(x)$
and $z= z(x)$.

We construct the function
\begin{align}
  \uuh  = \vvh + \ggh \label{eq:galerkin-construc}
\end{align}
%
where $\ggh$ is given by satisfying the essential boundary condition
$\ggh(L) = g$ and $\vvh$ corresponds to the displacement. We
substitute \eqref{eq:galerkin-construc} into \eqref{eq:weak-approx} to
obtain
%
\begin{align}
  a(\young\area\wwh,\vvh) = (\wwh, f) + \young(0)\area(0)\wwh(0)\bch - 
  a(\young\area\wwh,\ggh)\label{eq:galerkin}
\end{align}
%
the weighting function can be defined as
%
\begin{align}
  \wwh = \sum_{i=0}^{\nel-1} c_i \shape_i \label{eq:wwh-sum}
\end{align}
%
where $\shape_i$ is so-called a \emph{basis (shape) function} for
element $i$. Similarly, we define
%
\begin{align}
  \vvh = \sum_{i=0}^{\nel-1} d_i \shape_i \label{eq:vvh-sum}
\end{align}
where $c_i, d_i$ are constants.

After substitution of \eqref{eq:wwh-sum} and \eqref{eq:vvh-sum} into
the \eqref{eq:galerkin} and using the bilinearity property of
operators $a(\cdot,\cdot)$ and $(\cdot,\cdot)$ we get an expression
%
\begin{align}
  \sum_{j=0}^{\nel-1} a(\young\area\shape_i, \shape_j) d_j = (\shape_i, f) + \young(0)\area(0)\shape_i(0) \bch - a(\young\area\shape_i,\shape_\nel)\bcg. \label{eq:galerkin-row}
\end{align}
%
Using a notation
%
\begin{subequations}
  \begin{align}
    \stme{ij} =& a(\young\area\shape_i,\shape_j) = \int_0^L \young(x)\area(x)\shape_{i,x}(x),\shape_{j,x}(x) \dd x \label{eq:stme} \\ 
    F_i =& (\shape_i,f) + \young(0)\area(0)\shape_i(0) \bch - a(\young\area\shape_i,\shape_{\nel}) \bcg .
  \end{align}\label{eq:fem-stme-fi}
\end{subequations}
%
Then equation \eqref{eq:galerkin-row} can be rewritten as
%
\begin{align}
  \sum_{j=0}^{\nel-1} \stme{ij} d_j = F_i
\end{align}
or more concisely as
\begin{align}
\stm \vdspl = \vfrc \label{eq:concise-eq}
\end{align}
where $\stm$ is a \emph{stiffness matrix}, $\vdspl$ is a
\emph{displacement vector} and $\vfrc$ is a \emph{force vector}.

\section{First problem}

Consider boundary value problem \eqref{eq:bvp} where $\bcg=\bch =0$ with a
constant force as $f(x) = q$, where $q=-1$, length of the piece is
$L=1$, cross-section area and young modulus are $A(x) = E(x) = 1$.

\subsection{Shape function}

We define the basis function and find its derivative for each element
$i$ of $\nel$ elements. In the middle elements we get
\begin{align}
\shape_i(x) =& \frac{x-x_{i-1}}{h_{i-1}}, &\shape_{i,x}(x) =& \frac{1}{h_{i-1}},&&\text{for } x_{i-1} \leq x \leq x_i \\
\shape_i(x) =& \frac{x_{i+1}-x}{h_{i}},  &\shape_{i,x}(x) =& -\frac{1}{h_{i}}, &&\text{for }x_i \leq x \leq x_{i+1} \\
\shape_i(0) =& 0,                       &\shape_{i,x}(0) =& 0,                &&\text{elsewhere.}
\end{align}
%
whereas for the boundary node we have
%
\begin{align}
\shape_0(x) =& \frac{x_1-x}{h_{0}},             &\shape_0(x) =& -\frac{1}{h_{0}},                          &&\text{for } x_0 \leq x \leq x_{1} \\
\shape_\nel(x) =& \frac{x-x_{\nel-1}}{h_{\nel-1}},&\shape_\nel(x) =& \frac{1}{h_{\nel-1}},             &&\text{for } x_{\nel-1} \leq x \leq x_\nel .
\end{align}

\subsection{\python\ Implementation}

Then we compute the values for the stiffness matrix using numerical
integration. In \python\ this can be done using \code{scipy.integrate}
function with a \code{integrate.quad} for a quadrature rule. The
output array contains a tupple containing the value of integral and
the maximum error of the result.

At first, we have integrated from the limits of $0$ all the way
thorough the length of the element $L$. This caused a problem when the
number of elements were greater than $16$. This was due to the fact
that the shape function is defined piecewise, and the results of
numerical integration were not sufficiently accurate. The way to
address this issue was to integrate only in the immediate surroundings
of each point, where the shape functions are actually
non-zero. However, this raised another issue, because the shape
functions were defined even out of the interval $[0,1]$. To avoid
integration in this area, we have hard-coded constrains directly to
the shape function. This could be obviously corrected, but because
the stiffness matrix will be computed element-wise in future version
of this code, it was neglected at this stage.

After constructing element stiffness matrix and the force vector, we
have proceed to the solution of the system \eqref{eq:concise-eq}. In
the first attempt, we have found the displacement vector by inverting
the stiffness matrix using \code{np.linalg.inv} function (we imported
\numpy\ library as \code{np}). So in the current version, we
solve the system using \code{np.linalg.solve} function, which uses
\lapack\ routine \code{_gesv}. A performance benchmark has shown
that for a $5000$ elements the solution of the system using the
\code{np.linalg.solve} is about four times than using matrix inversion
(\ie $2.5$ seconds compared to $8.6$ seconds on Intel Core i5-3470 CPU
at a clock frequency of 3.20GHz).
%
\note{it would be interesting to see what order of $N$ is the
  computational cost. It should be $\cO{N^2}$ for gaussian elimination
  and $\cO{N^3}$ for matrix inversion. }

The code for the computation is shown as follows.

\lstinputlisting[language=python, style=mystyle, breaklines=true]{galerkin.py}


\subsection{Results}

The results are depicted in \figref{fig:displacement}. The simulation
was done for eight free elements. The material is fixed at the point
$x=1$ at a position $0$. The solution is exact at the nods.

\begin{figure}
  \centering
  \includegraphics[width=1.0\textwidth]{fig/displacement.eps}
  \caption{Dependence of the displacement on the position (x-axis) for
    a computation of eight degrees of freedom. Numerical results at
    the nodes (red dots) are linearly interpolated (red lines) and
    compared to the exact solution (blue line).}
  \label{fig:displacement}
\end{figure}

The output of the program follows.
%
The first part corresponds to the computational cost (in seconds)
spend in the construction of force vector, stiffness matrix and on the
solution of the system. The values are very small for this

Further, the stiffness matrix and the force vector are printed and
finally the solution for the displacement is shown both as a numerical
result and exact solution obtained analytically. As the numerical
results are exact in this case, also the norm of the difference
between the numerical and analytical results is zero.
%
\note{the result at the nodes is 0, but what about the result on the
  midpoints? Hughes seems to talk about relative error in $u_{,x}$
  what is that useful for?  How is the order of convergence?}

\tabref{tab:comp-cost} shows the computational results for the
simulation using $5000$ elements. The remaining parameters are
identical to the code presented. As seen in this example, the
construction of the stiffness matrix is the most time consuming task
despite the fact, that we do not compute the zero elements of the
matrix. The relatively high cost is caused due to numerical
integration.

In the following section we will focus on the computation of the
stiffness matrix element-wise.

\begin{table}
  \centering
  \label{tab:comp-cost}
\caption{Computational cost of the solving of the system for $N=5000$.}
\begin{tabular}{ll}
  \toprule
  Task & cost (seconds)\\
  \midrule
  Constructing stiffness matrix: & 7.161638498306274   \\
  Constructing force vector:     & 0.33005428314208984 \\
  Solving the system:            & 2.460254430770874   \\
  \bottomrule
\end{tabular}
\end{table}

\lstinputlisting[breaklines=true]{galerkin.out}

\section{Element-wise Construction of Stiffness Matrix and Force Vector}

The time of construction of the stiffness matrix for this case has
reduced from $7.16$ seconds to $0.05$ seconds in a computation of
$N= 5000$ nodes (as shown in the \tabref{tab:comp-cost}). This is
probably because now the stiffness is given explicitely, rather then
integrated from the shape functions.

\figref{fig:element} shows the results of the elementwise construction
of the stiffness matrix. This now also allows setting elements of
different length.

\begin{figure}
  \centering
  \includegraphics[width=1.0\textwidth]{fig/element.eps}
  \caption{Element wise construction of the stiffness matrix.}
  \label{fig:element}
\end{figure}

\lstinputlisting[language=python, style=mystyle, breaklines=true]{element.py}

-\note{it remains to explain the element-wise construction of the stiffness matrix}

\section{Combining Solid and Flow Mechanics}

This section aims to develop a model combining the mechanics for solid
and flow. This aims to simulate the formation of the composite
structure of carbon fibre and resin. During the formation the material
is placed into a pressure chamber, where a pressure is applied to the
material in an elevate temperatures. Due to the high temperature, the
resin becomes liquid and the pressure causes the flow of the resin out
of the material such that the carbon fibres become compressed
together. Consequently the resin undergoes a process of cure, that
causes a solidification of the resin so that the material is ``glued''
together. The following text is motivated by an article by
\citet{Hubert1999}.

Here we consider a toy model for a formation of the material as
described.  In this situation the total stress is composed according
to the Terzaghi principle, which states that the porous material
subjected to pressure is opposed by the fluid pressure in the
pores. Mathematicaly, this is described as
%
\begin{align}
\stress = \efstress(x,t) - \press(x,t) \label{eq:flow-stress}
\end{align}
%
where $\press(x,t)$ is the resin pressure and the effective stress
$\efstress$ that are dependent both on the reference position $x$ and
the time $t$. The effective stress is connected with the
displacement by a constitutive law
\begin{align}
\efstress = u_{,x},
\end{align}
%
where the parameters describing the properties of the material are
neglected and $u= u(x,t)$ represents the displacement.


From the Newton third law (sum of forces equals to zero) we get
%
\begin{align}
  0 =
  \stress_{,x} + f(x) =
  \efstress_{,x}(x,t) - \press(x,t)_{,x} + f(x) =
  % (u_{,x}(x,t) - \press(x,t))_{,x} + f(x) =\nonumber \\
  u_{,xx}(x,t) - \press_{,x}(x,t) + f(x) 
  % , 
  % &&u(0) = \bcg, u_{,x}(L) = -\bch\label{eq:bvp-t}.
\end{align}
%
where the body forces and the inertia of the material are neglected
$f(x) = 0$, as the gravitaional force is small compared to the applied
pressure, and the deformation, and hence the speeds are small.
%
So we obtain a boundary value problem
%
\begin{align}
  u_{,xx}(x,t) - \press_{,x}(x,t) + f(x) \label{eq:bvp-flow}
  = 0 , &&& u(0,t) = 0,\\\nonumber
        &&&u(L,t) =
            \begin{cases}
              -Rt &\text{ for } t < T,\\
              -RT &\text{ for } t > T.
            \end{cases} 
\end{align}
%
The boundary at the reference point $L$ is compressed by a press with
a constant speed $R$ for in the first $T$ time units. Then the press
is stoped at the possition reached after $T$.

%

The flow of the resin through the fibre bed will follow Darcy's law.
This law describes the flow of a fluid through a porous material, and
is analogous to Ohm's law from the theory of electric circuits. The
Darcy's law reads as
%
\begin{align}
  v(x,t) = -\frac{K}{\mu} \press_{,x}. \label{eq:darcy}
\end{align}
where the $v(x,t)$ is the velocity of the flow, $K$ is a fibre bed
permeability (due to the size of the pores),
%
%
$\mu$ is the resin viscosity.
% , and $\rdense$ is the density of the resin.
%
% \note{later $K =K(t)$ will depend on time as the pores go gradually
%   copressed.  For small deformations this effect is neglected. Also,
%   $\mu$ will depend on the resin temperature and the state of
%   cure of the resin.}
%
For simplicity, let's consider a case where $K/\mu=1$.
% , so the
% equation \eqref{eq:darcy} gives $v(x,t) = -(\press + \rdense g x)$. 
%

The velocity of the flow constrains the position of the fibre bed,
hence by linking the definition of velocity $v = - u_{,t}$ (recall the
notation $u_{,t} = \partial u/\partial t$) with the Darcy's law, we
can write an inital value problem for the internal points of the
material as
%
\begin{align}
  u_{,t}(x,t) =  \press_{,x} , && u(x,0) = 0 , \text{ for } 0 < x < L. \label{eq:velocity}
\end{align}


\subsection{Finite Differences Solution}

We write the boundary \eqref{eq:bvp-flow} and initial
\eqref{eq:velocity} value problem in a simplified form, where the
physical units are ignored, as follows
%
\begin{align}
  \label{eq:heat}
  u_{,xx}(x,t) - u_{,t}(x,t) + f(x) 
  =& 0 ,        &&u(x,0) = 0, u(L,t) =
            \begin{cases}
              -Rt &\text{ for } t < T,\\
              -RT &\text{ for } t > T,
            \end{cases}\\\nonumber
 &&& u(0,t) = 0.
\end{align}

The simplest method for solving this system is a finite difference
method. This use time and space discretisation as
%
\begin{subequations}
  \begin{align}
    x_i = x_0 + i\dx,\\
    t_j = t_0 + j\dt,
  \end{align} \label{eq:discr}
\end{subequations}
%
where $\dx$ is the space step and $\dt$ is the time step.  So we can
write the displacement at a certain point in time-space as
$\disp{i}{j} \approx u(x_i,t_j)$. Then we find the discretisation as
%
\begin{subequations}
  \begin{align}
    u_{,t}(x_i,t_j)  =& \frac{\disp{i}{j+1} - \disp{i}{j}}{\dt} + \bigO{\dt}, \\
    u_{,xx}(x_i,t_j) =& \frac{\disp{i+1}{j} - 2\disp{i}{j} + \disp{i-1}{j}}{\dx^2} + \bigO{\dx^2},
  \end{align}\label{eq:fin-diff}
\end{subequations}
%
where $\mathcal{O}$ is so-called big-O notation that specifies the
order of the approximation and corresponds to the part of the solution
that is ignored.

Substituting \eqref{eq:fin-diff} into \eqref{eq:heat} we get the
numerical algorithm as
%
\begin{align}
  % \frac{\disp{i+1}{j} - 2\disp{i}{j} + \disp{i-1}{j}}{\dx^2} -
  % \frac{\disp{i}{j+1} - \disp{i}{j}}{\dt}  
  % + f(x_i) 
  % = 0 \\
\disp{i}{j+1}  =   \disp{i}{j} + \dt\left(\frac{\disp{i+1}{j} - 2\disp{i}{j} + \disp{i-1}{j}}{\dx^2}   + f(x_i) \right). \label{eq:findiff-alg}
 % +\bigO{\dx^2, \dt}.
\end{align}

\begin{figure}
  \centering
  \begin{tabular}{l@{}l}
    \includegraphics[width=0.5\linewidth]{fig/flow.eps}&
                                                     \includegraphics[width=0.5\linewidth]{fig/surf.eps}\\
    (a)&(b)
  \end{tabular}
  \caption{Finite difference solution of equation
    \eqref{eq:heat}. Panel (a) shows the dependence of the
    displacement on the possition in initial state (blue), at $t=0.1$
    (magenta), at $t=0.2$ (green) and at the end of the simulation
    $t=0.4$.  Panel (b) shows the time dependence (horizontal line) of
    the deformation (colour-coded, left bar) in the reference frame.}
  \label{fig:findiff-heat}
\end{figure}

\figref{fig:findiff-heat} shows the solution of equation
\eqref{eq:heat} using finite difference method
\eqref{eq:findiff-alg}. The time step $\dt=0.001$ and space step
$\dx = 0.1$ such that the space contains $N_x=10$ nodes. The initial
conditions $\disp{i}{0} = 0$. The bottom boundary is fixed at
$\disp{0}{t} = 0$, while the top boundary move with a speed $R=1$ such
that $\disp{N_x}{j} = j \dt R$.

\lstinputlisting[language=python, style=mystyle, breaklines=true]{findiff.py}

\subsection{Physical units}

The goal of the previous text was to develop a simple toy example of a
type of equations describing the system. In the process we have ignored
or largely simplify the physical units to obtain a model with
mathematical characteristics rather then aiming for physical
precision. In the following text we focus to address the assumptions
in order to obtain more physically detailed model. The constants in the
models are shown in \tabref{tab:phys-const}.

The first assumption we made was that the stress is a linear function
of the strain $\varepsilon = u_{,x}$. This is only correct for very
small deformations when the volume fraction of the fibre does not
change much.  The stress is a non-linear variable dependent on the
volume fraction of the carbon fibre in the material. As the fibres are
packed the stiffness will increase non-linearly. The the following
formula shows a good agreement with experiments \citet{Gutowski1987},
\ie it is a heuristic model
% 
\begin{align}
  \efstress = A_s
  \frac{\frac{\vfrac}{V_0} -1}{\left(\frac{1}{\vfrac} -\frac{1}{V_a}\right)^4}, \label{eq:stress-nonlin}
\end{align}
%
where $A_s$ is so-called spring constant\note{reference for the expression of spring constant? In the \citet{Gutowski1987} only $A_s$ is specified.},
%
\begin{align}
  A_s = \frac{3\pi E_f}{\beta^4},
\end{align}
%
fitted to experimental data and their values are specified in
\tabref{tab:phys-const}.
%
The fibre volume fraction $V_0$, and $V_a$ represents the ratio
between the total volume and the fibre volume at the initial, maximal
packing respectively. The fibre volume fraction is found as
%
\begin{align}
  \vfrac = \frac{V_0}{1+\strain} \label{eq:fibre-volume}
\end{align}
%
where $\strain =  u_{,x}$.

\figref{fig:consolidation} shows the change in the properties of the material during the consolidation. All panels shown for the region of the independent variable for which was the model designed. The panel (a) shows the dependency of the volume fraction on the strain as described by the \eqref{eq:fibre-volume}. As the strain decreases, \ie\ fibre bed is compressed, the fibres consolidate which means that the volume fraction of the fibres increase. The panel (b) shows the effective stress in the fibre bed during the consolidation as described by \eqref{eq:stress-nonlin}. In this panel we can observe that as the fibre volume fraction increases, the fibre bed becomes stiffer, which can be observed as higher stress. The last panel (c) shows the combination of the two previous pannels (a,b) and can be interpreted as the increase of stiffness with the consolidation.
%
\begin{figure}
  \centering
  \includegraphics{consolidation.pdf}
  \caption{Mechanical properties of the material during the consolidation of the carbon fibres. The combination of dependence of volume fraction on the strain as shown in panel (a), combined with the dependence of stress on volume fraction shown in panel (b), gives the dependence of the stress as a function of strain as shown in panel (c).}
  \label{fig:consolidation}
\end{figure}

In the Darcy's law in equation \eqref{eq:darcy} we assumed the ratio
between fibre bed permeability and the viscosity of the resin
$K/\mu=1$. However, the permeability will depend on the volume
fraction of the resin as
%
\begin{align}
  K = \frac{r_f^2}{4k} \frac{(1-\vfrac)^3}{\vfrac^2} \label{eq:permeability}
\end{align}
%
where $r_f$ specifies the fiber radius and $k$ is so called Kozeny
constant (see \tabref{tab:phys-const}). Also, the viscosity is a
function of other variables, such as temperature and the degree of
cure of the resin.

\figref{fig:permeab} shows the dependence of the permeability fo the fibre bed during consolidation. Panel (a) shows the permeability as a function of  fibre volume fraction. When the fibre volume fraction is  high, the size of the pores between the material is higher, so the permeability is low. As the material is compressed and the fibre volume fraction reduces, the size of the pores reduces as well which results in the reduction of the permeability.
%
\begin{figure}
  \centering
  \includegraphics{permeab.pdf}
  \caption{Permeability of the fibre bed during the consolidation.
    The figure (a) The combination of dependence of volume fraction on
    the strain as shown in \figref{fig:consolidation}(a), combined
      with the dependence of the permeability on volume fraction shown
      in this figure panel (a), gives the dependence of the
      permeability as a function of strain as shown in panel (b).}
  \label{fig:permeab}
\end{figure}


%
Other assumption which we did the Darcy's law in equation
\eqref{eq:darcy} regards the visosity of the resin.  The viscosity
which should be substituted to \eqref{eq:darcy} is given by
\note{where does it come from?}
%
\begin{align}
  \mu = % g(\vfrac)
  \muinf \exp{\frac{E_\mu }{R T}} \left(\frac{\curegel}{\curegel - \cure}\right)^{A+B\cure} \label{eq:viscosity}
\end{align}
%
where the constants ($\muinf$, $\curegel$, $R$, $E_\mu$, $A$ and
$B$) are explained in \tabref{tab:phys-const}, % $g(\vfrac)$ accounts for
% low viscosity of the air \note{how to call it? what it means?},
$T$ is the temperature in Kelvins, which is controled in the
experiment, $\cure$ is the degree of cure that will be discussed
later and which takes values in the interval $[0,1]$.

\figref{fig:viscos} shows the dependence of the viscosity of the resin
on the temperature and the degree of cure of the resin. Panel (a)
shows the dependence on the temperature. As the temperature increases
the resin ``melts'' which means that it becomes more viscous. Panel
(b) shows the dependence of the viscosity on the degree of cure
$\cure$. Although, the $\cure$ is allowed to get the interval between
$[0,1]$ there is a singularity at a point $\cure = 0.48$, where the
resin becomes nearly solid.

\begin{figure}
  \centering
  \includegraphics{viscosity.pdf}
  \caption{Viscosity of the resin. Panel (a) shows the dependence of the
    viscosity on the temperature for three different values of
    $\cure$: magenta line $\cure=0.1$, green line $\cure=0.2$, cyan
    line $\cure=0.4$, panel (b) shows the dependence of the viscosity
    on the degree of cure for three different temperature: magenta
    line $\temp = 100$\degree C, green line $\temp = 130$\degree C, and cyan line
    $\temp = 180$\degree C.}
  \label{fig:viscos}
\end{figure}



The resin cure is described by a differential equation in a form
%
\begin{align}
  \cure_{,t} =  A_\cure \exp{-\frac{E_\cure }{RT}} \cure^m (1-\cure)^n \label{eq:cure}
\end{align}
%
where the constants ($A_\cure$, $E_\cure$, $m$, $n$ and $R$) are
given in the table, $T$ is the temperature as mentioned above.


\begin{table}
  \centering
  \begin{tabular}{llll}
    \toprule
    physical meaning & notation & value & units \\
    \midrule
    Young's modulus               & $E_f$        & $230$         & GPa            \\ 
    data fitting constant         & $\beta$      & $350$         & (unitless)            \\
    initial fibre volume fraction & $V_0$        & $0.55$        & (unitless)     \\
    maximum fibre volume fraction & $V_a$        & $0.68$        & (unitless)     \\
    \midrule
    radius of fibre               & $r_f$        & $4\ee{-3}$    & mm             \\
    Kozeny constant              & $k$          & $0.2$         & 1/s \QM            \\
    \midrule
    viscosity asymptote     & $\muinf$ & $3.45\ee{-10}$ & Pa$\cdot$s \QM \\ 
    activation energy \note{of what?}    & $E_\mu$ & $7.6536\ee{5}$& J/mol\\
    universal gas constant        & $R$          & $8.617$       & eV/K           \\
    degree of cure at  gelation   & $\curegel$   & $0.47$        & (unitless)            \\ 
    data fitting constant        &$A$ & $3.8$&(unitless)\\
    data fitting constant        &$B$ & $2.5$&(unitless)\\
    \midrule
     data fitting constant             &$A_\cure$&$1.53\ee{5}$& 1/s \\
     activation energy             &$E_\cure$& $6.65\ee{4}$  & J/mol          \\
     data fitting constant             &$m$&$0.813$& (unitless) \\
     data fitting constant             &$n$&$2.74$& (unitless) \\
    \bottomrule
  \end{tabular}
  \caption{Physical constants. The parts separated by line explain variable from different equations, the first part corresponds to stress as given in \eqref{eq:stress-nonlin}, the second part corresponds to permeability as given in \eqref{eq:permeability}, the third part corresponds to viscosity as given in \eqref{eq:viscosity}, the fourth part corresponds to cure as given in \eqref{eq:cure}. If the variable is used in more than one equation, it is explained at a place of its first occurence.}
  \label{tab:phys-const}
\end{table}


\subsection{Implementation of Physical model}

Here we describe the implementation of the models including the
physical units. To simplify the process, the implementation will be
done in several steps as follows
%
\begin{enumerate}
\item constant fibre volume fraction of $\vfrac = 0.6$, temperature $T=\QM$, and degree of cure $\cure$; this gives a linear model with appropriate physical units, \label{en:all-const}
\item fibre volume fraction dependent on the deformation according to formula \eqref{eq:fibre-volume}, the remaining variables as in previous case,
\item ramped temperature $T_{,t} = q$ which leads to variable degree of cure $\cure$.
\end{enumerate}

Solving the point \ref{en:all-const} we write down the model using the physical units. From the 


\bibliographystyle{apalike}
\bibliography{references}


\end{document}
